graph TB
    %% TIP MDS EMR - System Architecture

    %% Actors/Users
    Guest["ğŸ‘¤ Guest User<br/>(Unauthenticated)"]
    Student["ğŸ‘¨â€ğŸ“ Student<br/>(Medical Records Access)"]
    Doctor["ğŸ‘¨â€âš•ï¸ Doctor<br/>(Healthcare Provider)"]
    Admin["âš™ï¸ Admin<br/>(System Administrator)"]
    APIClient["ğŸ”Œ API Client<br/>(External Systems)"]

    %% Presentation Layer
    subgraph Presentation["ğŸ¨ PRESENTATION LAYER"]
        Templates["ğŸ“„ Django Templates<br/>HTML/CSS/JavaScript"]
        StaticFiles["ğŸ–¼ï¸ Static Assets<br/>(WhiteNoise)"]
        MediaFiles["ğŸ“ Media Storage<br/>(User Uploads)"]
    end

    %% Middleware Layer
    subgraph Middleware["ğŸ”§ MIDDLEWARE LAYER"]
        Security["ğŸ”’ Security Middleware"]
        Session["ğŸ« Session Management"]
        CORS["ğŸŒ CORS Headers"]
        CSRF["ğŸ›¡ï¸ CSRF Protection"]
        Auth["ğŸ” Authentication"]
    end

    %% Application Layer - Core
    subgraph CoreApps["ğŸ’¼ CORE BUSINESS LOGIC"]
        AccountsApp["ğŸ‘¤ Accounts App<br/>â€¢ Custom User Model<br/>â€¢ Email Auth Backend<br/>â€¢ Profile Management"]
        StudentsApp["ğŸ‘¨â€ğŸ“ Students App<br/>â€¢ Registration<br/>â€¢ Medical Records<br/>â€¢ Appointments"]
        DoctorsApp["ğŸ‘¨â€âš•ï¸ Doctors App<br/>â€¢ Doctor Dashboard<br/>â€¢ Prescriptions<br/>â€¢ Certificates"]
        AppointmentsApp["ğŸ“… Appointments App<br/>â€¢ Scheduling<br/>â€¢ Approval Workflow<br/>â€¢ Status Management"]
    end

    %% Application Layer - Supporting
    subgraph SupportApps["ğŸ”” SUPPORTING SERVICES"]
        NotificationsApp["ğŸ”” Notifications<br/>â€¢ Real-time Alerts<br/>â€¢ User Preferences<br/>â€¢ API Endpoints"]
        AnalyticsApp["ğŸ“Š Analytics<br/>â€¢ System Metrics<br/>â€¢ Usage Reports<br/>â€¢ Dashboard Data"]
        TemplatesDocsApp["ğŸ“‹ Document Templates<br/>â€¢ Prescriptions<br/>â€¢ Certificates<br/>â€¢ Clearances"]
    end

    %% API Layer
    subgraph APILayer["ğŸ”Œ REST API LAYER"]
        DRF["Django REST Framework<br/>â€¢ Serialization<br/>â€¢ ViewSets<br/>â€¢ Authentication"]
    end

    %% Data Persistence Layer
    subgraph DataLayer["ğŸ—„ï¸ DATA PERSISTENCE"]
        ORM["Django ORM<br/>(Object-Relational Mapper)"]
        Database["ğŸ’¾ SQLite Database<br/>â€¢ User Accounts<br/>â€¢ Medical Records<br/>â€¢ Appointments<br/>â€¢ Notifications"]
    end

    %% External Services
    subgraph External["â˜ï¸ EXTERNAL SERVICES"]
        PDF["ğŸ“„ WeasyPrint<br/>(PDF Generation)"]
        Email["ğŸ“§ Email Service<br/>(SMTP)"]
        FileStorage["ğŸ“¦ File Storage<br/>(Local/Cloud)"]
    end

    %% Infrastructure
    subgraph Infrastructure["ğŸš€ DEPLOYMENT"]
        Gunicorn["ğŸ¦„ Gunicorn<br/>(WSGI Server)"]
        WhiteNoise["âš¡ WhiteNoise<br/>(Static Files)"]
    end

    %% User Interactions
    Guest --> Templates
    Student --> Templates
    Doctor --> Templates
    Admin --> Templates
    APIClient --> DRF

    %% Request Flow
    Templates --> Security
    StaticFiles --> WhiteNoise
    Security --> Session
    Session --> CORS
    CORS --> CSRF
    CSRF --> Auth

    %% Middleware to Apps
    Auth --> AccountsApp
    Auth --> StudentsApp
    Auth --> DoctorsApp
    Auth --> AppointmentsApp
    Auth --> NotificationsApp
    Auth --> AnalyticsApp
    Auth --> TemplatesDocsApp

    %% API Layer
    DRF --> AccountsApp
    DRF --> NotificationsApp

    %% Data Access
    AccountsApp --> ORM
    StudentsApp --> ORM
    DoctorsApp --> ORM
    AppointmentsApp --> ORM
    NotificationsApp --> ORM
    AnalyticsApp --> ORM
    TemplatesDocsApp --> ORM
    ORM --> Database

    %% External Service Integration
    DoctorsApp --> PDF
    TemplatesDocsApp --> PDF
    NotificationsApp --> Email
    AccountsApp --> Email
    StudentsApp --> FileStorage
    DoctorsApp --> FileStorage
    MediaFiles --> FileStorage

    %% Infrastructure
    Gunicorn -.-> Templates
    WhiteNoise -.-> StaticFiles

    %% Styling
    classDef userStyle fill:#e3f2fd,stroke:#1565c0,stroke-width:3px
    classDef presentationStyle fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef middlewareStyle fill:#f3e5f5,stroke:#6a1b9a,stroke-width:2px
    classDef appStyle fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px
    classDef dataStyle fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef externalStyle fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    classDef infraStyle fill:#e0f2f1,stroke:#00695c,stroke-width:2px

    class Guest,Student,Doctor,Admin,APIClient userStyle
    class Templates,StaticFiles,MediaFiles presentationStyle
    class Security,Session,CORS,CSRF,Auth middlewareStyle
    class AccountsApp,StudentsApp,DoctorsApp,AppointmentsApp,NotificationsApp,AnalyticsApp,TemplatesDocsApp,DRF appStyle
    class ORM,Database dataStyle
    class PDF,Email,FileStorage externalStyle
    class Gunicorn,WhiteNoise infraStyle